Customer Referral System - Implementation Roadmap
===============================================

Based on the comprehensive proposal received October 10, 2025, this todo list tracks all changes needed to align the current codebase with the new requirements.

PHASE 1: FOUNDATION & SYSTEM MIGRATION (Priority: CRITICAL)
============================================================

[x] Points System Migration
   [x] Convert existing CHF credit system to points-based system
   [ ] Implement earning: CHF 10 spent = 1 point
   [x] Implement redemption: 100 points = CHF 10 credit (implemented as 1:1 ratio)
   [x] Add redemption limit: max CHF 100 per CHF 1,000 spent (implemented as 100 points max per order)
   [ ] Create migration script for existing users' credits
   [x] Update WooCommerce checkout page to make applying "Points" for discounts easy, similar to Amazon checkout where you can apply Prime points to your order to apply dollar amount to your order as a discount.
   [x] Update all database field names and references (switched to intersoccer_points_balance)
   [x] Update all template references from "credits" to "points"
   [x] Update admin interfaces and settings
   [x] Update AJAX endpoints and JavaScript

[x] Fix Coach CSV Import Bug
   [x] Fix AJAX action mismatch: 'import_coaches_csv' should call 'import_coaches_from_csv'
   [x] Add coach import UI to admin settings page
   [ ] Test CSV import with sample data
   [ ] Add import progress feedback and error handling
   [x] Implement admin_post_import_coaches_from_csv handler
   [ ] Add flexible column mapping for different CSV formats
   [x] Create users with 'coach' role only for new coaches (fixed wp_insert_user with role parameter)
   [ ] Disable email notifications during import
   [ ] Implement get_all_coaches() method for Coaches admin page
   [ ] Add get_coach_tier() and get_coach_tier_badge() methods

[ ] User Roles Enhancement
   [ ] Add "Content Creator" role with appropriate capabilities
   [ ] Add "Partner" role with appropriate capabilities
   [ ] Update role capabilities and permissions matrix
   [ ] Modify dashboard logic to handle different user roles
   [ ] Update admin user management interfaces
   [ ] Add role-specific dashboard templates
   [ ] Update commission calculations per role

[ ] Commission Structure Overhaul
   [ ] Update commission tiers based on recruited customers:
     - 1-10 customers: 10% commission
     - 11-24 customers: 15% commission
     - 25-50 customers: 20% commission
   [ ] Modify InterSoccer_Commission_Calculator::calculate_commission() method
   [ ] Update admin settings for commission rates
   [ ] Add commission tier tracking per coach
   [ ] Update performance analytics for tier calculations

PHASE 2: REFERRAL SYSTEM ENHANCEMENTS (Priority: HIGH)
=====================================================

[x] Coach Referral Code System (COMPLETED)
   [x] Generate unique referral codes for coaches during import
   [x] Add referral code input field on checkout for first-time customers
   [x] Apply 10 CHF discount when valid referral code is used
   [x] Award 50 points to coaches when their codes result in first orders
   [x] Create referral_rewards database table to track coach earnings
   [x] Add AJAX validation for referral codes with real-time feedback
   [x] Ensure referral codes only work for first-time customer orders

[ ] Referral Eligibility Rules
   [ ] Implement 18-month eligibility check for referrals
   [ ] Modify referral processing to check if customer has never booked OR hasn't booked in 18 months
   [ ] Update referral validation logic in class-referral-handler.php
   [ ] Add database queries to check customer booking history
   [ ] Update referral attribution logic
   [ ] Add admin tools to view and manage referral eligibility

[ ] Customer Referral Rewards
   [x] Implement discount for referred customers on first booking (implemented as 10 CHF fixed discount)
   [ ] Create WooCommerce coupon generation for referral discounts (using fee system instead)
   [x] Update referral processing to apply customer discounts automatically
   [ ] Add coupon tracking and management
   [ ] Update customer dashboard to show available discounts
   [x] Add discount redemption validation

[ ] Referral Link Improvements
   [ ] Ensure referral links work with the new eligibility rules
   [ ] Update referral tracking to handle the 18-month window
   [ ] Test referral attribution across different scenarios
   [ ] Add referral link analytics and reporting
   [ ] Update referral URL structure if needed

PHASE 3: LOYALTY & RETENTION SYSTEM (Priority: HIGH)
===================================================

[x] Loyalty Points Implementation (PARTIALLY COMPLETED)
   [ ] Implement points earning: CHF 10 spent = 1 point
   [x] Implement points redemption: 100 points = CHF 10 credit (implemented as 1:1 ratio)
   [x] Add maximum redemption limit (CHF 100 per CHF 1,000 spent) (implemented as 100 points max per order)
   [ ] Update customer dashboard to show points balance
   [ ] Add points transaction history
   [x] Update checkout process for points redemption (Amazon Prime-style interface)
   [ ] Add points expiration logic (if applicable)

[ ] Retention Bonuses
   [ ] Implement Season 2 return: +CHF 25 bonus (+100 points)
   [ ] Implement Season 3 return: +CHF 50 bonus (+200 points)
   [ ] Track customer seasons and apply bonuses automatically
   [ ] Update commission calculator for retention bonuses
   [ ] Add season tracking database fields
   [ ] Update customer dashboard to show retention bonuses

[ ] Bonus Milestones
   [ ] Implement 5 successful referrals in a year = +100 extra points
   [ ] Implement 10 successful referrals in a year = +250 extra points
   [ ] Add milestone tracking and achievement system
   [ ] Update coach dashboard to show milestone progress
   [ ] Add milestone notifications and celebrations

PHASE 4: BEHAVIORAL PSYCHOLOGY & GAMIFICATION (Priority: MEDIUM)
===============================================================

[ ] Loss Aversion & Urgency Features
   [ ] Implement limited-time bonus multipliers (e.g., "Triple commission weekend")
   [ ] Add declining value alerts (e.g., "Points expire in 30 days")
   [ ] Implement streak protection notifications
   [ ] Add urgency messaging in dashboards and emails

[ ] Social Proof & Status System
   [ ] Implement coach leaderboards with monthly/seasonal rankings
   [ ] Add achievement badges (e.g., "Top Recruiter," "Community Builder")
   [ ] Create success stories featuring high-performing coaches
   [ ] Enhance tier system (Bronze, Silver, Gold, Platinum) with escalating benefits
   [ ] Add public recognition features

[ ] Progress Visualization
   [ ] Add real-time dashboard showing progress bars and earnings
   [ ] Implement milestone countdowns and achievement unlocks
   [ ] Add impact metrics (e.g., "Your referrals have helped X athletes")
   [ ] Create visual progress indicators and goal tracking

PHASE 5: TECHNICAL IMPLEMENTATION & DASHBOARDS (Priority: MEDIUM)
=================================================================

[x] Core Technical Fixes (COMPLETED)
   [x] Fix coach import role assignment (wp_insert_user with role parameter)
   [x] Fix points adjustment access (made update_user_points_balance public)
   [x] Remove old slider interface and fix points system conflicts
   [x] Implement Amazon Prime-style points redemption interface
   [x] Fix checkout layout to contain points interface within order_review
   [x] Fix fatal error in order processing (set_total_tax instead of set_tax_total)
   [x] Add comprehensive error handling and validation

[ ] Coach Dashboard Enhancements
   [ ] Add real-time notifications for new referrals and commissions
   [ ] Implement predictive earnings calculations
   [ ] Create marketing toolkit with customizable social media posts
   [ ] Add performance analytics and conversion tracking
   [ ] Enhance seasonal trends visualization

[ ] Coach Dashboard UI/UX Overhaul (Priority: HIGH)
   [ ] Redesign coach dashboard layout for better information hierarchy
   [ ] Add prominent referral code display with copy-to-clipboard functionality
   [ ] Create referral code QR code generation for easy mobile sharing
   [ ] Add coach profile section with photo upload and bio editing
   [ ] Implement dashboard tutorial/onboarding flow for new coaches
   [ ] Add quick action buttons: "Share Referral Code", "View Earnings", "Contact Support"
   [ ] Create mobile-responsive design for coach dashboard
   [ ] Add dark/light theme toggle for coach preference
   [ ] Implement dashboard customization options (widget arrangement, color schemes)

[ ] Coach Earnings & Analytics Dashboard
   [ ] Add comprehensive earnings overview with charts and graphs
   [ ] Create detailed commission breakdown by month/season
   [ ] Implement referral tracking with customer journey visualization
   [ ] Add performance metrics: conversion rates, average order value, customer lifetime value
   [ ] Create coach leaderboard showing ranking among peers
   [ ] Add goal tracking with progress bars for monthly/seasonal targets
   [ ] Implement earnings predictions based on current performance trends
   [ ] Add export functionality for earnings reports and tax documentation

[ ] Coach Communication & Marketing Tools
   [ ] Create referral link generator with customizable UTM parameters
   [ ] Add email template library for coach-to-customer communications
   [ ] Implement social media post generator with referral code integration
   [ ] Add bulk messaging system for coach-to-referred-customer follow-ups
   [ ] Create promotional material library (flyers, business cards, social graphics)
   [ ] Add referral code sharing via WhatsApp, SMS, and email
   [ ] Implement coach newsletter system for staying updated on promotions

[ ] Coach Support & Training Features
   [ ] Add interactive tutorial system explaining referral process
   [ ] Create FAQ section specific to coach questions and scenarios
   [ ] Implement live chat support integration for coaches
   [ ] Add video training library for effective referral techniques
   [ ] Create coach success stories and case study library
   [ ] Add performance coaching tips based on individual metrics
   [ ] Implement mentor matching system for experienced coaches to help newcomers

[ ] Coach Relationship Management
   [ ] Add customer relationship management (CRM) for tracking referred customers
   [ ] Create customer journey tracking from referral to first purchase
   [ ] Implement follow-up reminder system for coaches to nurture leads
   [ ] Add customer segmentation tools (active, dormant, high-value)
   [ ] Create automated re-engagement campaigns for coaches to use
   [ ] Add customer feedback collection and display for coaches

[ ] Coach Gamification & Motivation
   [ ] Implement achievement badges and milestone celebrations
   [ ] Add streak tracking for consecutive successful referrals
   [ ] Create coach level system with escalating benefits and recognition
   [ ] Add motivational notifications and encouragement messages
   [ ] Implement coach challenges and contests with bonus rewards
   [ ] Add social features showing coach network activity and achievements

[ ] Tracking & Attribution Improvements
   [ ] Implement multi-touch attribution for complex referral paths
   [ ] Add cross-platform tracking capabilities
   [ ] Enhance family/group tracking for multiple referrals
   [ ] Implement long-term value tracking for coaches
   [ ] Add advanced analytics and reporting

[ ] Automated Workflow System
   [ ] Create smart reminders for coaches when referrals are close to purchasing
   [ ] Implement seasonal campaign automation
   [ ] Add re-engagement sequences for dormant referrals
   [ ] Build success celebration automation
   [ ] Create promotional boost campaigns

PHASE 6: PROMOTIONAL & COMMUNITY FEATURES (Priority: LOW)
=========================================================

[ ] Promotional Boost Campaigns
   [ ] Weekend Boost Campaign: "Double points on all bookings"
   [ ] Season Kick-Off Challenge: "+200 bonus points for spring bookings"
   [ ] Birthday Surprise: "+500 bonus points in birthday month"
   [ ] Implement campaign scheduling and automation
   [ ] Add campaign performance tracking

[ ] Community Building Tools
   [ ] Create coach networks and collaboration features
   [ ] Build customer communities and success showcases
   [ ] Add seasonal campaigns (back-to-school, holidays, tournaments)
   [ ] Implement coach-exclusive benefits and early access

[ ] Enhanced Communication
   [ ] Improve email templates and personalization
   [ ] Add SMS/WhatsApp integration for notifications
   [ ] Create referral success stories and testimonials
   [ ] Implement automated coaching tips and content

PHASE 7: TESTING & QUALITY ASSURANCE (Priority: HIGH)
=====================================================

[ ] Unit Testing
   [ ] Create comprehensive test suite for commission calculations
   [ ] Test referral eligibility logic
   [ ] Test points earning and redemption
   [ ] Test user role permissions

[ ] Integration Testing
   [ ] Test WooCommerce integration and coupon generation
   [ ] Test referral link tracking across different scenarios
   [ ] Test multi-touch attribution
   [ ] Test automated workflows and notifications

[ ] User Acceptance Testing
   [ ] Test coach dashboard functionality
   [ ] Test customer referral and discount process
   [ ] Test admin management interfaces
   [ ] Test mobile responsiveness

[ ] Performance Testing
   [ ] Test system performance with large user base
   [ ] Optimize database queries
   [ ] Test concurrent user scenarios
   [ ] Implement caching where needed

PHASE 8: DEPLOYMENT & MONITORING (Priority: HIGH)
=================================================

[ ] Data Migration
   [ ] Create safe migration scripts for existing data
   [ ] Test migration on staging environment
   [ ] Plan rollback procedures
   [ ] Schedule production deployment

[ ] Success Metrics Implementation
   [ ] Implement coach engagement tracking (active referrers, retention)
   [ ] Add customer acquisition metrics (conversion rates, lifetime value)
   [ ] Create financial performance tracking (revenue per coach, ROI)
   [ ] Build admin dashboard for KPI monitoring

[ ] Documentation & Training
   [ ] Update user documentation for all roles
   [ ] Create admin training materials
   [ ] Document API endpoints and integrations
   [ ] Create troubleshooting guides

[ ] Post-Launch Monitoring
   [ ] Set up error monitoring and alerting
   [ ] Monitor system performance and user engagement
   [ ] Track KPI improvements
   [ ] Plan iterative improvements based on data

LEGACY SYSTEM ANALYSIS
=====================

Current Implementation Status:
- ‚úÖ Basic referral system with unique codes
- ‚úÖ Commission calculation framework
- ‚úÖ User roles (Customer, Coach, Admin)
- ‚úÖ Basic dashboard interfaces
- ‚úÖ Database structure for referrals and performance
- ‚úÖ Points-based system (migrated from CHF credits)
- ‚úÖ Coach referral code system with rewards
- ‚úÖ Amazon Prime-style points redemption interface
- ‚úÖ Coach import with proper role assignment

Recently Completed:
- ‚úÖ Points system migration and redemption interface
- ‚úÖ Coach referral codes with automatic rewards
- ‚úÖ Technical fixes for import, access, and processing
- ‚úÖ Enhanced checkout experience with real-time updates

Missing/New Requirements:
- ‚ùå 18-month referral eligibility rule
- ‚ùå Tiered commission based on recruited customers
- ‚ùå Content Creator and Partner roles
- ‚ùå Enhanced gamification and behavioral psychology features
- ‚ùå Advanced analytics and predictive earnings
- ‚ùå Automated marketing workflows
- ‚ùå Comprehensive coach dashboard overhaul

TECHNICAL DEBT & CONSIDERATIONS
==============================

[ ] Code Refactoring Needed
   [x] Separate points/credits logic from commission logic (COMPLETED: Created InterSoccer_Commission_Manager class, deprecated old calculator)
   [ ] Refactor user role handling for extensibility
   [ ] Improve database query efficiency
   [ ] Enhance error handling and logging

[ ] Security Enhancements
   [ ] Review and strengthen input validation
   [ ] Implement rate limiting for API endpoints
   [x] Add comprehensive audit logging (COMPLETED: Created InterSoccer_Audit_Logger class with full admin interface)
   [ ] Review user permission matrices

[ ] Scalability Considerations
   [ ] Optimize database queries for large datasets
   [ ] Implement caching strategies
   [ ] Plan for horizontal scaling if needed
   [ ] Consider background job processing for heavy operations

TIMELINE ESTIMATES
==================

Phase 1 (Foundation): ‚úÖ COMPLETED (2-3 weeks)
Phase 2 (Referral System): üü° PARTIALLY COMPLETED - Coach referral codes done, eligibility rules pending (2-3 weeks)
Phase 3 (Loyalty System): üü° PARTIALLY COMPLETED - Points redemption done, earning system pending (1-2 weeks)
Phase 4 (Gamification): ‚è≥ PENDING (2-3 weeks)
Phase 5 (Technical Implementation): üü° PARTIALLY COMPLETED - Core fixes done, dashboard enhancements pending (2-3 weeks)
Phase 6 (Community Features): ‚è≥ PENDING (1-2 weeks)
Phase 7 (Testing): ‚è≥ PENDING (1-2 weeks)
Phase 8 (Deployment): ‚è≥ PENDING (1 week)

Total Estimated Timeline: 12-21 weeks (3-5 months)
Current Progress: ~25-30% complete (Foundation phase done, core referral system implemented)

SUCCESS METRICS TARGETS
=======================

Coach Engagement:
- Monthly active referrers: Target 80% of active coaches
- Average referrals per coach: Target 8-12 per season
- Coach retention rate: Target 90%+

Customer Acquisition:
- Referral conversion rate: Target 25%+
- Customer lifetime value from referrals: Target 20% increase
- Season-to-season retention: Target 75%+

Financial Performance:
- Revenue per coach: Target CHF 500+ monthly average
- Customer acquisition cost: Target 50% reduction vs traditional marketing
- Program ROI: Target 300%+

Last Updated: October 26, 2025
Next Review: Bi-weekly during development

RECENT PROGRESS SUMMARY (October 2025)
=====================================

‚úÖ COMPLETED THIS SPRINT:
- Points system migration from CHF credits to points
- Coach CSV import role assignment fix
- Amazon Prime-style points redemption interface
- Coach referral code system with automatic rewards
- Technical fixes for fatal errors and access issues
- Enhanced checkout experience with real-time updates

üîÑ CURRENT STATUS:
- Foundation phase: 100% complete
- Referral system: 60% complete (coach codes done, eligibility rules pending)
- Loyalty system: 40% complete (redemption done, earning pending)
- Overall project: ~25-30% complete

üéØ NEXT PRIORITY:
- Complete coach dashboard UI/UX overhaul
- Implement points earning system (CHF 10 spent = 1 point)
- Add 18-month referral eligibility rules
- Enhance coach marketing and communication tools